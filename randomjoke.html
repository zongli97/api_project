<!DOCTYPE html>
<html lang="en-us">
<head>
    <title>Get A Random Joke!</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0"> 
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js"></script>
    <link rel="stylesheet" href="css/app.css">
</head>
<body>
    <div class="container">
        <div class="row">
            <div class="col-sm-12">
                &nbsp;
            </div>
        </div>
        <div class="row">
            <div class="col-sm-3">
            </div>    
            <div class="col-sm-6 color_wheat" id="div-joke" style="border-style:solid">
                <br>
                <img src="dadjoke.png" alt="Dad Joke" class="center">
                <br><br>
                <h5>Hit the "Get Random Joke" <br> button to generate one on the screen. <br> <br> If you would like to hear it play out, 
                    press the "Hear The Joke" button and copy & paste the joke in the text area! </h5>
                <br>
                <form id="frm_get_joke">
                    <div id="get_joke">
                    </div>
                    <br>
                    <input type="button" id="btn_random_joke" value="Get Random Joke" class="btn btn-primary">
                    <br><br> 
                    <input type="button" id="btn_hear_joke" value="Hear The Joke" class="btn btn-primary">
                    <br><br>
                </form>
            </div>

            <div class="col-sm-6 color_wheat" id="div-speech" style="border-style:solid">
                <br>
                <img src="minionsgif.gif" alt="Minions Laughing" class="center">
                <br>
                <form id="frm_text_to_speech">
                    <div style="display: none">
                    <audio id="audioPlayer" src="" autoplay="autoplay"></audio>
                    </div>
                    <br>
                    <textarea id="pastetext" name="message" placeholder="Paste Or Type Your Joke Here!"></textarea>
                    <br>
                    <div id="get_audio">
                    </div>
                    <br>
                    <div id="confirmation"></div>
                    <br>
                    <input type="button" id="btn_hear_speech" value="Hear The Joke" class="btn btn-primary">
                    <br><br>
                    <input type="button" id="btn_another_joke" value="Get Another Joke" class="btn btn-primary">
                    <br><br>
                </form>
            </div>
            <div class="col-sm-3">
            </div>    
        </div>
        <div class="row">
            <div class="col-sm-12">
            &nbsp;
            </div>
        </div>            
    </div>
</body>
<script>
    //
// These are the API URLS to use:
// https://jokes.p.rapidapi.com/joke/random
// https://cloudlabs-text-to-speech.p.rapidapi.com/synthesize
//
"use strict";

$("#div-joke").show();
$("#div-speech").hide();
// supporting functions
function generate_joke(){

    var settings = {
        "async": true,
	"crossDomain": true,
	"url": "https://jokes10.p.rapidapi.com/api/jokes/random",
	"method": "GET",
	"headers": {
		"x-rapidapi-host": "jokes10.p.rapidapi.com",
		"x-rapidapi-key": "4ab27cc78bmsh823326e5d045bfap1e9051jsn41fe3cfc5933"
    }
}
    $.getJSON(settings).done(function(joke){
        console.log(joke);

        let setup = joke[0].joke_text;
        let punchline = joke[0].joke_punchline;
        let text = "<div class='bg-setup'>" + setup + "</div>" + 
        "<div class='bg-punchline'>" + punchline + "</div>" + "<br>";
        $('#get_joke').append(text);
    })
}

function generate_speech(){
    var settings = {
	"async": true,
	"crossDomain": true,
	"url": "https://cloudlabs-text-to-speech.p.rapidapi.com/synthesize",
	"method": "POST",
	"headers": {
		"content-type": "application/x-www-form-urlencoded",
		"x-rapidapi-host": "cloudlabs-text-to-speech.p.rapidapi.com",
		"x-rapidapi-key": "4ab27cc78bmsh823326e5d045bfap1e9051jsn41fe3cfc5933"
	},
	"data": {
		"voice_code": "en-US-1",
		"text": $('#pastetext').val(),
		"output_type": "audio_url"
	}
}

$.post(settings).done(function (speech) {
	console.log(speech);

    let audiolink = speech.result.audio_url;
    document.getElementById("audioPlayer").src = audiolink;
});
}

// click handlers

$('#btn_random_joke').click(function(){
	generate_joke();
})

$('#btn_hear_joke').click(function(){
    $("#div-joke").hide();
    $("#div-speech").show();
})

$('#btn_hear_speech').click(function(){
    let text=$('#pastetext').val()
    if(text==''){
    $('#confirmation').removeClass();
    $('#confirmation').html('Please type or paste a joke!');
    $('#confirmation').addClass('alert alert-danger');
}
    else{
    $('#confirmation').removeClass();
    $('#confirmation').html('');
    generate_speech();
}
})

$('#btn_another_joke').click(function(){
    $("#div-joke").show();
    $("#div-speech").hide();
})
</script>   
</html>